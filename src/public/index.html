<!DOCTYPE html>
<html>
  <head>
    <title>template_microservice - index.html</title>
    <link rel="stylesheet" href="/css/template_microservice.css" type="text/css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/vue"></script>

  </head>
  <body>

    <ul id="todo-list">
      <list-item v-for="item in todoList" v-bind:todo="item" v-bind:key="item._id">
    </ul>

    <script>

    var TodoEditor = Vue.extend({
      props: ['todo'],
      template: `<input type="text" v-model="todo.text"></li>`
    });


    var TodoEntry = Vue.extend({
      props: ['todo'],
      template: `<div><input type="checkbox" v-model="todo.completed" v-on:change="completeTodo"><label class="text" for="checkbox">{{ todo.text }}</label></div>`,
      methods: {
        completeTodo: function(event) {
          // TODO: make an API call to complete the todo
        }
      }
    });

    var ListItem = Vue.component('list-item', {
      props: ['todo'],
      template: `
      <li v-on:dblclick="handleDoubleClick" v-on:keypress="handleKeyPress">
        <component v-bind:is="currentView" v-bind:todo="todo">
        </component>
      </li>`,
      data: function() {
        return {
          currentView: 'entry'
        };
      },
      methods: {
        handleDoubleClick: function(event) {
          // TODO: memoize the current state of todo.text
          this.currentView = "editor";
        },
        handleKeyPress: function(event) {
          // TODO: determine if the enter key or the escape key was pressed
          // if the escape key was pressed, reset the state
          // if the enter key was pressed, make an API call to update the
          // todo text
          this.currentView = "entry";
        }
      },
      components: {
        entry: TodoEntry,
        editor: TodoEditor
      }
    });

    var app = new Vue({
      el: '#todo-list',
      data: {
        todoList: []
      }
    });

    $(function() {
      $.ajax({
        url: '/read-them-all'
      }).done(function(data) {
        app.todoList = JSON.parse(data);
      });
    });
    </script>
    
  </body>
</html>
